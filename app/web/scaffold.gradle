// ################################################################################
// Scaffolding project structure
// ################################################################################
scaffold << {
	// source packages
	def base = project.group + "." + rootProject.name + "." + project.name
	def client = base + ".client"
	def shared = base + ".shared"
	def server = base + ".server"
	def gin = client + ".gin"
	def place = client + ".place"
	def app = client + ".application"
	def ui = app + ".ui"
	def home = app + ".home"
	def i18n = client + ".i18n"
	def resources = client + ".resources"
	def ws = client + ".ws"
	def model = shared + ".model"
	def wsServer = server + ".ws"

	new File(webAppDir.toString() + "/WEB-INF/web.xml").text = file(ext.templateBasePath + 'web.xml').text.replaceAll("@module@", rootProject.name).replaceAll("@package@", base)
	new File(webAppDir.toString() + "/WEB-INF/logging.properties").text = file(ext.templateBasePath + 'logging.properties').text.replaceAll("@module@", rootProject.name)
	new File(webAppDir.toString() + "/WEB-INF/appengine-web.xml").text = file(ext.templateBasePath + 'appengine-web.xml').text.replaceAll("@module@", rootProject.name)
	new File(webAppDir.toString() + "/index.html").text = file(ext.templateBasePath + 'index.html').text.replaceAll("@module@", rootProject.name)
	new File(webAppDir.toString() + "/sticky-footer-navbar.css").text = file(ext.templateBasePath + 'sticky-footer-navbar.css').text

	// build classname for entryPoint
	char[] rootProjectArray = rootProject.name.toCharArray();
	rootProjectArray[0] = Character.toUpperCase(rootProjectArray[0]);
	char[] projectArray = project.name.toCharArray();
	projectArray[0] = Character.toUpperCase(projectArray[0]);
	def entryPointClassName =  new String(rootProjectArray) + new String(projectArray);
	
	sourceSets.main*.java.srcDirs*.each {

		// Module file (*.gwt.xml) ############################################
		new File(it.toString() + "/" + base.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + base.replaceAll("\\.", "/") + "/" + rootProject.name + ".gwt.xml").text = file(ext.templateBasePath + "/module.gwt.xml").text.replaceAll("@module@", rootProject.name).replaceAll("@base@", base)

		// .client ############################################################
		new File(it.toString() + "/" + client.replaceAll("\\.", "/")).mkdirs()

		// .gin ###############################################################
		new File(it.toString() + "/" + gin.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + gin.replaceAll("\\.", "/") + "/ClientModule.java").text = file(ext.templateBasePath + "/client/gin/ClientModule.java").text.replaceAll("@package@", gin).replaceAll("@base@", base)

		// .place #############################################################
		new File(it.toString() + "/" + place.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + place.replaceAll("\\.", "/") + "/NameTokens.java").text = file(ext.templateBasePath + "/client/place/NameTokens.java").text.replaceAll("@package@", place)

		// .application #######################################################
		new File(it.toString() + "/" + app.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + app.replaceAll("\\.", "/") + "/ApplicationModule.java").text = file(ext.templateBasePath + "/client/application/ApplicationModule.java").text.replaceAll("@package@", app).replaceAll("@base@", base)
		new File(it.toString() + "/" + app.replaceAll("\\.", "/") + "/ApplicationPresenter.java").text = file(ext.templateBasePath + "/client/application/ApplicationPresenter.java").text.replaceAll("@package@", app).replaceAll("@base@", base)
		new File(it.toString() + "/" + app.replaceAll("\\.", "/") + "/ApplicationView.java").text = file(ext.templateBasePath + "/client/application/ApplicationView.java").text.replaceAll("@package@", app).replaceAll("@base@", base)
		new File(it.toString() + "/" + app.replaceAll("\\.", "/") + "/ApplicationView.ui.xml").text = file(ext.templateBasePath + "/client/application/ApplicationView.ui.xml").text.replaceAll("@base@", base).replaceAll("@base@", base)

		// .application.ui ####################################################
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/") + "/UiModule.java").text = file(ext.templateBasePath + "/client/application/ui/UiModule.java").text.replaceAll("@package@", ui)
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/") + "/Header.java").text = file(ext.templateBasePath + "/client/application/ui/Header.java").text.replaceAll("@package@", ui).replaceAll("@base@", base)
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/") + "/Header.ui.xml").text = file(ext.templateBasePath + "/client/application/ui/Header.ui.xml").text.replaceAll("@base@", base).replaceAll("@module@", rootProject.name)
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/") + "/Footer.java").text = file(ext.templateBasePath + "/client/application/ui/Footer.java").text.replaceAll("@package@", ui).replaceAll("@base@", base)
		new File(it.toString() + "/" + ui.replaceAll("\\.", "/") + "/Footer.ui.xml").text = file(ext.templateBasePath + "/client/application/ui/Footer.ui.xml").text.replaceAll("@base@", base)

		// .application.home ##################################################
		new File(it.toString() + "/" + home.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + home.replaceAll("\\.", "/") + "/HomeModule.java").text = file(ext.templateBasePath + "/client/application/home/HomeModule.java").text.replaceAll("@package@", home)
		new File(it.toString() + "/" + home.replaceAll("\\.", "/") + "/HomeUiHandlers.java").text = file(ext.templateBasePath + "/client/application/home/HomeUiHandlers.java").text.replaceAll("@package@", home)
		new File(it.toString() + "/" + home.replaceAll("\\.", "/") + "/HomePresenter.java").text = file(ext.templateBasePath + "/client/application/home/HomePresenter.java").text.replaceAll("@package@", home).replaceAll("@base@", base)
		new File(it.toString() + "/" + home.replaceAll("\\.", "/") + "/HomeView.java").text = file(ext.templateBasePath + "/client/application/home/HomeView.java").text.replaceAll("@package@", home).replaceAll("@base@", base)
		new File(it.toString() + "/" + home.replaceAll("\\.", "/") + "/HomeView.ui.xml").text = file(ext.templateBasePath + "/client/application/home/HomeView.ui.xml").text.replaceAll("@base@", base)

		// .i18n ##############################################################
		new File(it.toString() + "/" + i18n.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + i18n.replaceAll("\\.", "/") + "/AppConstants.java").text = file(ext.templateBasePath + "/client/i18n/AppConstants.java").text.replaceAll("@package@", i18n)
		new File(it.toString() + "/" + i18n.replaceAll("\\.", "/") + "/AppMessages.java").text = file(ext.templateBasePath + "/client/i18n/AppMessages.java").text.replaceAll("@package@", i18n)
		new File(it.toString() + "/" + i18n.replaceAll("\\.", "/") + "/AppConfig.java").text = file(ext.templateBasePath + "/client/i18n/AppConfig.java").text.replaceAll("@package@", i18n).replaceAll("@version@", version).replaceAll("@buildDate@", new Date().toString())

		// .resources #########################################################
		new File(it.toString() + "/" + resources.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + resources.replaceAll("\\.", "/") + "/AppResources.java").text = file(ext.templateBasePath + "/client/resources/AppResources.java").text.replaceAll("@package@", resources)
		new File(it.toString() + "/" + resources.replaceAll("\\.", "/") + "/MainCss.java").text = file(ext.templateBasePath + "/client/resources/MainCss.java").text.replaceAll("@package@", resources)

		// client.ws ##########################################################
		new File(it.toString() + "/" + ws.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + ws.replaceAll("\\.", "/") + "/BasicRestClient.java").text = file(ext.templateBasePath + "/client/ws/BasicRestClient.java").text.replaceAll("@package@", ws).replaceAll("@base@", base)
		new File(it.toString() + "/" + ws.replaceAll("\\.", "/") + "/AbstractRestCallback.java").text = file(ext.templateBasePath + "/client/ws/AbstractRestCallback.java").text.replaceAll("@package@", ws)
		new File(it.toString() + "/" + ws.replaceAll("\\.", "/") + "/HttpConstants.java").text = file(ext.templateBasePath + "/client/ws/HttpConstants.java").text.replaceAll("@package@", ws)
		new File(it.toString() + "/" + ws.replaceAll("\\.", "/") + "/AuthenticationDispatcher.java").text = file(ext.templateBasePath + "/client/ws/AuthenticationDispatcher.java").text.replaceAll("@package@", ws)

		// .model #############################################################
		new File(it.toString() + "/" + model.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + model.replaceAll("\\.", "/") + "/UserDto.java").text = file(ext.templateBasePath + "/shared/model/UserDto.java").text.replaceAll("@package@", model)

		// .server.ws #########################################################
		new File(it.toString() + "/" + wsServer.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + wsServer.replaceAll("\\.", "/") + "/BasicRestEndpoint.java").text = file(ext.templateBasePath + "/server/ws/BasicRestEndpoint.java").text.replaceAll("@package@", wsServer).replaceAll("@base@", base)
	}

	sourceSets.main*.resources.srcDirs*.each {
		// .resources #########################################################
		new File(it.toString() + "/" + resources.replaceAll("\\.", "/")).mkdirs()
		new File(it.toString() + "/" + resources.replaceAll("\\.", "/") + "/main.css").text = file(ext.templateBasePath + "/client/resources/main.css").text
	}
}